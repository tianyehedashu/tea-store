# 风险、测试与验收

## 1. 主要风险与应对
- 国际物流复杂度：先以模板分段收费，后续细化。
- 筛选/搜索性能：小规模先用组合过滤，必要时接入搜索服务。
- Sanity 安全：Token 仅服务端持有，最小权限；Webhook 路由签名校验与白名单。
- ISR 失效延迟：增加 Webhook 重试与队列、页面级精准失效、手动再验证入口（保护路由）。

## 2. 测试策略
- 后端
  - `seed.ts` 初始化正确性；支付/配送配置；
  - （可选缓存层）API 契约与分页/筛选；
- 前端
  - 页面与组件渲染；Sanity DTO 映射；Quick Brew 回落逻辑；
  - 关键流程（加车→结账→完成）；错误态与空态；
  - 预览模式与 ISR：草稿可见性、发布后再验证路径正确与时效性；
- Sanity
  - Schema 校验、角色与权限、Webhook 事件触发稳定性；
- 非功能
  - LCP/INP/CLS 指标、图片体积、脚本分割、可访问性。

## 3. 验收标准
- 功能
  - 分类/产地/风味筛选、下单与支付成功；
  - 商品详情展示冲泡建议（覆盖优先，回落指南）；
  - 产地与指南页面 SEO 可收录（sitemap+SSR）；
- 内容
  - 编辑者可“创建/预览/发布”并在 1 分钟内前台可见；
  - Webhook 与再验证稳定，无误伤；
- 质量
  - 关键路径具备测试覆盖；性能达标；安全与配置检查通过。
