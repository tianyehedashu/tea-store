# 部署与运维建议

## 1. 环境与依赖
- Node.js 20+；后端运行在独立进程/容器；PostgreSQL 数据库。
- 后端环境变量：`DATABASE_URL`、`MEDUSA_*`、`STRIPE_*`/`PAYPAL_*`、`CORS_ORIGIN`。
- 前端环境变量：`MEDUSA_BACKEND_URL`、`NEXT_PUBLIC_MEDUSA_PUBLISHABLE_KEY`。

## 2. 构建与发布
- 后端：`yarn build && medusa start` 或容器化（健康检查、自动重启）。
- 前端：Next.js 构建，部署到 Vercel/容器；使用 Edge 中间件基于 `countryCode` 处理本地化。

## 3. 数据与迁移
- 自定义模块引入后执行迁移；使用只读用户访问生产库（除写入场景）。
- 备份策略：每日全量、每小时增量；保留 7-14 天。

## 4. 监控与告警
- 前端：错误上报（Sentry 等）、性能指标（LCP、INP、CLS）。
- 后端：请求日志、错误告警、支付失败率、订单转化率、库存预警。

## 5. 安全与合规
- 支付走托管网关；密钥管理（环境变量/密钥管理服务）。
- CORS 白名单仅允许前端域名；管理端访问限制与审计日志。
- 日志脱敏；备份加密；最小权限原则。

## 6. 运维日常
- 发布前检查：迁移、种子脚本、环境变量。
- 回滚策略：蓝绿/影子发布；失败回滚上一个稳定版本。
- 容量规划：依据日活、订单量与流量峰值，设置自动扩缩容阈值。
